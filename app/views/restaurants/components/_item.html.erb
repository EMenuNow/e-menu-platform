<% 
# colour = 'bg-light-70 text-dark' unless no_background  
# colour = 'bg-orange-70 text-light' if ['King Prawn','Poffertjes','Salad Box','The Fizz', 'Hand Cut Fries with Rosmary and Truffle salt'].include?(item["name"])
%>

<% if item[:node_type] == 'section' %>
  <div class="col-sm-12 text-left <%= item[:css_class] if item[:css_class].present?%>">
    <div class="order-item rounded" data-toggle="modal" data-target="#exampleModal">
      <div class="row  cursor-pointer">
        <div class="col text-danger">
          <strong class='section-name'><%=item[:name]%></strong>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <% if item[:children].present? %>
            <% nodes = [] %>
            <% item[:children].each do |child| %>
              <% if params[:dietary_ids].present? %>
                <% veggie_id = MenuItemCategorisation.where("lower(name) = ?", 'vegetarian').first.id.to_s %>
                <% also_veggie = child[:categories].where(name: 'vegan').any? && params[:dietary_ids].include?(veggie_id) %>
                <% next unless (params[:dietary_ids] + (also_veggie ? [veggie_id] : []) - (child[:categorisations].dietary.map{|mic| mic.menu_item_categorisation_id.to_s} + (also_veggie ? [veggie_id] : []))).empty? %>
              <% end %>
              <% if params[:may_contain_allergen_ids].present? %>
                <% next unless (child[:categorisations].allergies.map{|mic| mic.menu_item_categorisation_id.to_s} & params[:may_contain_allergen_ids]).empty? %>
              <% end %>
              <% if params[:contains_allergen_ids].present? %>
                <% next unless (child[:categorisations].contains_allergen.map{|mic| mic.menu_item_categorisation_id.to_s} & params[:contains_allergen_ids]).empty? %>
              <% end %>
              <% nodes << child %>
            <% end %>
            <% if nodes.blank? %>
              <%= render 'restaurants/components/no_item' %>
            <% else %>
              <% nodes.each do |child| %>
                <%= render 'restaurants/components/item', item: child, no_background: true %>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

<% else %>
  <div class="item-default <%= item[:ancestry].split('/').count == 3 ? 'col' : 'col-sm-12' %> <%= item[:css_class] if item[:css_class].present?%>">
    <div class=" p-1 rounded cursor-pointer" data-toggle="modal" data-target="#item-<%=item[:id]%>">
      <div class="row pb-1">
        <div class="col">
          <div class="row">
            <div class='col-auto pr-0 item-title'>
              <strong class='item-name '>
                <%=item[:name]%> 
              </strong>
            </div>
            <div class="col-auto pr-0">
              <% if item[:categorisations].allergies.any? %>
                <ul class="row eicon-list m-0 pb-1 eicon-x-small ng-scope align-items-center">
                  <% item[:categorisations].contains_allergen.each do |allergen| %>
                    <li class="allergen-level-yes my-0 align-baseline pb-1"><span class="<%= allergen.menu_item_categorisation.icon %>"></span></li>
                  <% end %>
                  <% item[:categorisations].may_contain_allergen.each do |allergen| %>
                    <li class="allergen-level-may my-0 align-baseline pb-1"><span class="<%= allergen.menu_item_categorisation.icon %>"></span></li>
                  <% end %>
                  <% item[:categorisations].dietary.each do |diet| %>
                    <li class="suitable-level-yes my-0 align-baseline pb-1"><span class="<%= diet.menu_item_categorisation.icon %>"></span></li>
                  <% end %>
                </ul>
              <% end %>
            </div>
          </div>
        </div>
        <div class='col-auto text-right'>
          <strong class='item-name'>
            <%=number_to_currency(item[:price_a], unit: @restaurant.currency_symbol)%>
          </strong>
        </div>
      </div>
      <% if item[:image].present? or item[:description].present? %>
      <div class="row pt-2">
        <% if feature_match(:images, @restaurant.features) %>
        <% image = get_menu_image(item[:id]) %>
        <% if image.present? %><div class='col-3'><%= image_tag image.variant(resize: "200x200"), class: 'img-fluid' %><%#=image_tag url_for(image), class: 'img-fluid'%></div><% end %>
        <% end %>
        <% if item[:description].present? %><div class='col'><small><i><%=item[:description]%></i></small></div><% end %>
      </div>
      <% end %>
    </div>
  </div>
  <%= render 'restaurants/components/modal', item: item if is_takeaway_or_delivery?(@restaurant)%>
<% end %>